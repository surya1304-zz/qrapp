{"ast":null,"code":"var fs = require('file-system');\n\nvar path = require('path');\n\nvar request = require('ajax-request');\n\nfunction base64(filename, data) {\n  var extname = path.extname(filename).substr(1);\n  extname = extname || 'png';\n\n  if (extname === 'svg') {\n    extname = \"svg+xml\";\n  }\n\n  return 'data:image/' + extname + ';base64,' + data.toString('base64');\n}\n\nfunction img(data) {\n  var reg = /^data:image\\/([\\w+]+);base64,([\\s\\S]+)/;\n  var match = data.match(reg);\n  var baseType = {\n    jpeg: 'jpg'\n  };\n  baseType['svg+xml'] = 'svg';\n\n  if (!match) {\n    throw new Error('image base64 data error');\n  }\n\n  var extname = baseType[match[1]] ? baseType[match[1]] : match[1];\n  return {\n    extname: '.' + extname,\n    base64: match[2]\n  };\n}\n/**\n * @description\n * Get image file base64 data\n * @example\n * base64Img.base64('path/demo.png', function(err, data) {})\n */\n\n\nexports.base64 = function (filename, callback) {\n  if (!callback) callback = util.noop;\n  fs.readFile(filename, function (err, data) {\n    if (err) return callback(err);\n    callback(null, base64(filename, data));\n  });\n};\n/**\n * @description\n * The api same as base64, but it's synchronous\n * @example\n * var data = base64Img.base64Sync('path/demo.png');\n */\n\n\nexports.base64Sync = function (filename) {\n  var data = fs.readFileSync(filename);\n  return base64(filename, data);\n};\n/**\n * @description\n * Get base64 from url\n * @example\n * request.base64(\n *   'http://webresource.c-ctrip.com/ResCRMOnline/R5/html5/images/57.png', \n *   function(err, res, body) {\n * \n *   }\n * );\n */\n\n\nexports.requestBase64 = function (url, callback) {\n  request({\n    url: url,\n    isBuffer: true\n  }, function (err, res, body) {\n    if (err) return callback(err);\n    var data = 'data:' + res.headers['content-type'] + ';base64,' + body.toString('base64');\n    callback(err, res, data);\n  });\n};\n/**\n * @description\n * Convert image base64 data to img\n * @example\n * base64Img.img('data:image/png;base64,...', 'dest', '1', function(err, filepath) {});\n */\n\n\nexports.img = function (data, destpath, name, callback) {\n  var result = img(data);\n  var filepath = path.join(destpath, name + result.extname);\n  fs.writeFile(filepath, result.base64, {\n    encoding: 'base64'\n  }, function (err) {\n    callback(err, filepath);\n  });\n};\n/**\n * @description\n * The api same as img, but it's synchronous\n * @example\n * var filepath = base64Img.imgSync('data:image/png;base64,...', 'dest', '1');\n */\n\n\nexports.imgSync = function (data, destpath, name) {\n  var result = img(data);\n  var filepath = path.join(destpath, name + result.extname);\n  fs.writeFileSync(filepath, result.base64, {\n    encoding: 'base64'\n  });\n  return filepath;\n};","map":null,"metadata":{},"sourceType":"script"}